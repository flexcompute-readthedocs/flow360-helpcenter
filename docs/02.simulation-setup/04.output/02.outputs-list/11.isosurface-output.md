# Isosurface Output

*Isosurface Output in Flow360 lets you visualize flow field variables on surfaces of constant value within the computational domain. This is particularly useful for identifying and analyzing coherent structures like vortices, shock waves, or temperature contours.*

---

## **Available Options**

| *Option* | *Description* | *Applicable* |
|----------|---------------|--------------|
| **Output fields** | Flow variables to include in the output | always |
| **Output format** | Format for saving isosurface data | always |
| **Save interval** | When to save outputs | always |
| **Frequency** | How often to save outputs | when **Save interval** is `Custom` |
| **Frequency offset** | Time step at which to start the output animation | when **Save interval** is `Custom` |
| **Isosurfaces** | Define one or more isosurfaces | always |

---

## **Global Time Stepping in Child Cases**

When working with **child cases** (cases forked from a parent simulation), it's important to understand that the `Frequency` and `Frequency offset` parameters refer to the **global** time step, which is transferred from the parent case.

**Example:** If the parent case finished at `time_step=174`, the child case will start from `time_step=175`. If `Frequency=100` is set in the child case, the output will be saved at global time steps 200 (25 time steps into the child simulation), 300 (125 time steps into the child simulation), etc. `Frequency offset` also refers to the global time step, meaning that if in the previously mentioned child case, `Frequency offset=50` was set (with `Frequency=100`), the output would be saved at **global** time steps 250 (75 time steps into the child simulation), 350 (175 time steps into the child simulation), etc.

---

## **Detailed Descriptions**

### **Output fields**

*Select the flow variables to include in the isosurface output.*

- **Default:** None
- **Example:** `Mach, pressure, velocity`
>**Note:** See detailed field descriptions below. Only select fields you need to analyze.

### **Output format**

*The file format used to save the isosurface output data.*

- **Default:** `paraview`
- **Example:** `both`
- **Options:**
  - `paraview`
  - `tecplot`
  - `both`
> **Notes:** 
> - Choose the format that best suits your post-processing workflow.
> - Select `paraview` for `.vtu` format, `tecplot` for `.plt` format, or `both` to save in both formats.

### **Save interval**

*Choose the points in the simulation where the results are saved.*

- **Default:** `Save at end`
- **Options:**
  - `Save at end`
  - `Custom` (only available when `Time stepping` is `Unsteady`)
> **Notes:** 
> - Choose `Save at end` to save only the final results of the simulation.
> - Choose `Custom` to save the results in given intervals.

### **Frequency**

*How often to save outputs, in number of physical time steps.*

- **Default:** `-1` (only at the end of simulation)
- **Example:** `100`
>**Notes:** 
> - Higher frequencies provide better temporal resolution but increase storage requirements.
> - Important for child cases - this parameter refers to the **global** time step (see [Global Time Stepping](#global-time-stepping-in-child-cases)).
> - This setting is only applicable for unsteady cases.

### **Frequency offset**

*The time step at which to start the output animation.*

- **Default:** `0` (beginning of simulation)
- **Example:** `1000`
>**Notes:** 
> - Useful when you want to skip initial transient flow development.
> - Important for child cases - this parameter refers to the **global** time step (see [Global Time Stepping](#global-time-stepping-in-child-cases)).
> - Example: if an output has a frequency of 100 and a frequency_offset of 10, the output will be saved at **global** time steps 10, 110, 210, etc.
> - This setting is only applicable for unsteady cases.

### **Assigned isosurfaces**

*Define one or more isosurfaces by specifying a field variable and iso-value.*

- **Default:** None
- **Definition parameters:**
  - **Name:** A unique identifier for the isosurface
  - **Field:** The flow variable used to define the isosurface
  - **Iso-value:** The constant value of the field variable that defines the isosurface
- **Example:** `qcriterion = 0.001`

---

## **Available Isosurface Fields**

*Isosurfaces can be defined based on the following field variables:*

- `p` - Pressure (non-dimensional)
- `rho` - Density (non-dimensional)
- `Mach` - Mach number (non-dimensional)
- `qcriterion` - Q criterion (for vortex identification) (non-dimensional)
- `s` - Entropy (non-dimensional)
- `T` - Temperature (non-dimensional)
- `Cp` - Coefficient of pressure (non-dimensional)
- `Cpt` - Total pressure coefficient (non-dimensional)
- `mut` - Turbulent viscosity (non-dimensional)
- `nuHat` - Spalart-Almaras variable (non-dimensional)
- `vorticityMagnitude` - Vorticity Magnitude (non-dimensional)

## **Available Output Fields**

Variables from [Available Output Fields](./README.md#available-output-fields) and the following specific variables

---

<details>
<summary><h3 style="display:inline-block"> üí° Tips</h3></summary>

### Common Isosurface Applications

1. **Vortex Identification**: Q-criterion isosurfaces (typically positive values)
   - This is one of the most common applications of isosurfaces in Flow360
   - The default isosurface value for auto-generated Q-criterion is `RefMach¬≤ / (all walls' bounding box length)¬≤`
   - For aircraft simulations: try `Mach¬≤ / WingSpan¬≤`
   - For rotor flows: try `TipMach¬≤ / RotorDiameter¬≤`
   - Use smaller values to reveal more vortical structures, larger values for only the strongest vortices

2. **Shock Wave Visualization**: 
   - Use Mach number or pressure gradient isosurfaces
   - For transonic flows, a Mach number around 1.0 can help locate shock waves
   - Pressure gradient isosurfaces can provide cleaner shock visualization

3. **Temperature Contours**: 
   - Temperature isosurfaces are useful for thermal analysis
   - Multiple isosurface values can show temperature stratification

4. **Separation Regions**: 
   - Skin friction or velocity isosurfaces can help identify separation regions
   - Near-zero velocity isosurfaces can indicate recirculation zones

### Performance Considerations

- Isosurfaces are computationally efficient compared to volume outputs
- The number and complexity of isosurfaces affect computational and visualization performance
- Try to limit the number of isosurfaces in a single output
- For complex flows, consider using multiple isosurface values to capture different flow features
- If visualization software is struggling with large isosurfaces, consider:
  - Simplifying the isosurface by increasing the iso-value
  - Using multiple isosurface outputs with different frequency settings
  - Reducing the number of output fields on the isosurface

</details>

---

<details>
<summary><h3 style="display:inline-block"> ‚ùì Frequently Asked Questions</h3></summary>

- **How do I choose the right iso-value for Q-criterion visualization?**  
  > Start with a value based on the flow characteristics:
  > - For aircraft: Try `Mach¬≤ / WingSpan¬≤`
  > - For rotors: Try `TipMach¬≤ / RotorDiameter¬≤`
  > - Decrease the value if you want to see more vortical structures
  > - Increase the value if you want to focus only on strongest vortices
  > - Experiment with different values, starting with orders of magnitude (0.1, 0.01, 0.001)

- **Which isosurface fields are best for different flow features?**  
  > Different fields highlight different aspects of the flow:
  > - **Vortices**: `qcriterion` (positive values) or `vorticityMagnitude`
  > - **Shock waves**: `Mach` (around 1.0) or `pressure` gradients
  > - **Thermal features**: `T` (temperature)
  > - **Separation and recirculation**: `velocity_magnitude` (near zero)
  > - **Turbulence regions**: `mut` (turbulent viscosity)

- **Can I create multiple isosurfaces with different fields in a single output?**  
  > Yes! You can define multiple isosurfaces in a single isosurface output:
  > - Each with different fields (e.g., one for `qcriterion`, one for `Mach`)
  > - Each with different iso-values
  > - All sharing the same output fields and frequency settings
  > This approach is more efficient than creating multiple separate isosurface outputs.

- **Why are my isosurfaces flickering in animations?**  
  > Isosurface flickering can occur due to:
  > - Unsteady flows where structures evolve rapidly
  > - Iso-values too close to background noise levels
  > - Insufficient temporal resolution (increase output frequency)
  > - Consider time-averaging for statistical visualization of unsteady features

- **How large are isosurface output files typically?**  
  > File sizes for isosurfaces are generally much smaller than volume outputs:
  > - Size depends on the complexity of the isosurface (how many triangles are needed to represent it)
  > - More complex flow features and lower iso-values typically generate larger files
  > - Each output field adds data to every point on the isosurface
  > - For a typical simulation, isosurface files might be 10-100 MB per timestep (compared to GB for volume outputs)

- **Why is my isosurface broken or incomplete?**  
  > Broken isosurfaces might occur because:
  > - The iso-value is too high, breaking continuous structures
  > - The feature doesn't exist in parts of the domain
  > - Flow features are evolving (especially in unsteady simulations)
  > - Output frequency may be too low to capture continuous evolution

</details>

---

<details>
<summary><h3 style="display:inline-block"> üêç Python Example Usage</h3></summary>

```python
# Example of configuring isosurface output using Flow360 Python API
import flow360 as fl
from flow360 import u

# Define multiple isosurfaces with different fields and values
isosurface_output = fl.IsosurfaceOutput(
    name="Flow Structures",
    output_format="paraview",
    isosurfaces=[
        fl.Isosurface(
            name="Vortex_Cores",
            iso_value=0.001,
            field="qcriterion",
        ),
        fl.Isosurface(
            name="Shock_Wave",
            iso_value=1.0,
            field="Mach",
        ),
        fl.Isosurface(
            name="Hot_Region",
            iso_value=1.2,
            field="T",
        ),
    ],
    output_fields=["velocity", "pressure", "Mach"],
    frequency=100,  # Save every 100 time steps
    frequency_offset=0,  # Start at the beginning of simulation
)

# Add isosurface output to simulation parameters
simulation_params = fl.SimulationParams(
    # ... other simulation parameters ...
    outputs=[isosurface_output]
)
```

</details> 