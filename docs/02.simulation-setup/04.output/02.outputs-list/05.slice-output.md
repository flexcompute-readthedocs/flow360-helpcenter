# Slice Output

*Slice Output in Flow360 allows you to visualize flow field variables on 2D cutting planes through the computational domain. The data is interpolated from the three-dimensional flow solution field onto the two-dimensional slice plane. This provides detailed insight into flow features at specific locations, while generating much smaller files than full volume outputs.*

---

## **Available Options**

| *Option* | *Description* | *Applicable* |
|----------|---------------|--------------|
| **Output fields** | Flow variables to include in the output | always |
| **Output format** | Format for saving output data | always |
| **Save interval** | When to save outputs | always |
| **Frequency** | How often to save outputs | when **Save interval** is `Custom` |
| **Frequency offset** | The time step at which to start the output | when **Save interval** is `Custom` |
| **Assigned slices** | Define one or more slice planes by specifying their origin and normal vector | always |

---

## **Detailed Descriptions**

### **Output fields**

*Select the flow variables to include in the output files.*

- **Default:** None (must select at least one)
- **Example:** `Cp, Mach, velocity`
>**Note:** See complete list of available fields below.

### **Output format**

*The file format for saving the slice data.*

- **Default:** `paraview`
- **Options:**
  - `paraview`
  - `tecplot`
  - `both`
> **Notes:** 
> - Choose the format that best suits your post-processing workflow.
> - Select `paraview` for `.vtu` format, `tecplot` for `.plt` format, or `both` to save in both formats.

### **Save interval**

*Choose the points in the simulation where the results are saved.*

- **Default:** `Save at end`
- **Options:**
  - `Save at end`
  - `Custom`
> **Notes:** 
> - Choose `Save at end` to save only the final results of the simulation.
> - Choose `Custom` to save the results in given intervals.

### **Frequency**

*How often to save outputs, measured in number of physical time steps.*

- **Default:** `-1` (only at the end of simulation)
- **Example:** `100` (save every 100 time steps)
>**Note:** For steady simulations, use -1 to save only at convergence. For unsteady simulations, set a positive value to create an animation.

### **Frequency offset**

*The time step at which to start the output animation.*

- **Default:** `0` (beginning of simulation)
- **Example:** `1000` (start saving at time step 1000)
>**Note:** Useful for skipping initial transient phases in unsteady simulations.

### **Assigned slices**

*Define one or more slice planes through the computational domain.*

- **Definition parameters:**
  - **Name:** A unique identifier for the slice
  - **Origin:** The 3D coordinates of a point on the slice plane
  - **Normal:** The normal vector to the slice plane (does not need to be normalized)

- **Example:** 
  ```
  Name: "Midspan"
  Origin: (0, 5, 0)
  Normal: (0, 1, 0)
  ```
>**Note:** Multiple slices can be defined, each with unique name, origin, and normal.

---

## **Available Output Fields**

Variables from [Available Output Fields](./README.md#available-output-fields) and the following specific variables

### **Volume-Specific Variables**

- `betMetrics` - BET Metrics
- `betMetricsPerDisk` - BET Metrics per Disk
- `linearResidualNavierStokes` - Linear residual of Navier-Stokes solver
- `linearResidualTurbulence` - Linear residual of turbulence solver
- `linearResidualTransition` - Linear residual of transition solver
- `SpalartAllmaras_hybridModel` - Hybrid RANS-LES output for Spalart-Allmaras solver (supports both DDES and ZDES)
- `kOmegaSST_hybridModel` - Hybrid RANS-LES output for kOmegaSST solver (supports both DDES and ZDES)
- `localCFL` - Local CFL number

### **Hybrid RANS-LES Output Variables**

The `SpalartAllmaras_hybridModel` and `kOmegaSST_hybridModel` output fields provide diagnostic variables for hybrid RANS-LES simulations. The specific variables included depend on whether you're using **DDES** (Delayed Detached Eddy Simulation) or **ZDES** (Zonal Detached Eddy Simulation) as the shielding function.

#### **DDES Variables** (when `shielding_function="DDES"`)

When using DDES, the hybrid model output includes five key variables:

1. **`f_d`** ‚Äì The shielding function that delineates the RANS and LES regions. When `f_d` = 0, the RANS model is fully applied; when `f_d` = 1, the LES model is used. Intermediate values represent a smooth transition between the two regimes.

2. **`r_d`** ‚Äì A modified ratio of the modeled length scale to the wall distance, from which `f_d` is derived.

3. **`DDES_lengthRANS`** ‚Äì The wall distance from the computational cell to the nearest solid boundary.

4. **`DDES_lengthScale`** ‚Äì The characteristic DES length scale: $\tilde{d} \equiv d - f_d \max(0, d - C_{DES}*\Delta)$

5. **`DDES_lengthLES`** ‚Äì The characteristic LES length scale: $C_{DES}*\Delta$

Among these variables, `f_d` is the most significant, as it enables users to identify and visualize the regions dominated by RANS and DES behavior within the computational domain.

#### **ZDES Variables** (when `shielding_function="ZDES"`)

When using ZDES, the hybrid model output includes four key variables:

1. **`ZDES_fp`** ‚Äì The enhanced shielding function that determines whether RANS or LES is used. When `ZDES_fp` = 0, RANS is active; when `ZDES_fp` = 1, LES is active. This function is computed from `ZDES_fd`, `ZDES_fR`, and `ZDES_fp2`.

2. **`ZDES_fd`** ‚Äì Original DDES shielding function used in computing `ZDES_fp`.

3. **`ZDES_fR`** ‚Äì is included to disable or inhibit this second shielding function in regions where vorticity magnitude is increasing away from walls - this is designed to disable the secondary shielding function where a shear layer is detected above a wall. Component used in computing `ZDES_fp`.

4. **`ZDES_fp2`** ‚Äì Causes the model to revert to RANS mode in the outer portion of boundary layers, used in computing `ZDES_fp`.

---

<details>
<summary><h3 style="display:inline-block"> üí° Tips</h3></summary>

#### Key Output Fields for Slice Analysis

- **Total Pressure Coefficient (Cpt)**
  - Effectively shows boundary layer development and growth
  - Clearly reveals flow separation regions 
  - Highlights wakes behind objects
  - Indicates regions of energy loss in the flow
  - Can be used to identify vortices and other flow structures

  To calculate the dimensional total pressure from Cpt:
  ```
  p_t (N/m¬≤) = Cpt √ó (1/2)œÅ‚àû √ó U_ref¬≤ + p_t‚àû
  ```

- **Mach Number and Velocity Fields**
  - Excellent for visualizing shock waves
  - Shows expansion regions
  - Reveals flow acceleration and deceleration zones
  - Indicates boundary layer thickness

#### Common Slice Orientations

- **XY Plane**: Normal = (0, 0, 1)
- **YZ Plane**: Normal = (1, 0, 0)
- **XZ Plane**: Normal = (0, 1, 0)

#### Strategic Slice Placement

Place slices at these key locations for maximum insight:

- Leading and trailing edges of aerodynamic surfaces
- Maximum thickness locations on wings or bodies
- Wing-body junctions to visualize corner flow
- Wake regions behind objects (at various downstream distances)
- Boundary layer regions (parallel to surface)
- Shock wave locations (approximately perpendicular to flow)

#### Visualization Recommendations

- **For boundary layer analysis**: Use `Cpt` with a color scale that highlights low values
- **For shock detection**: Use `Mach` or `pressure` with carefully adjusted color scales
- **For vortex visualization**: Use `vorticityMagnitude` or velocity vector plots
- **For separation detection**: Look for reversal in velocity vectors or negative streamwise velocity
- **For BET analysis**: Position slices at specific radial positions of the rotor disk

</details>

---

<details>
<summary><h3 style="display:inline-block"> ‚ùì Frequently Asked Questions</h3></summary>

- **How many slices can I create in a single simulation?**  
  > There is no hard limit on the number of slices, but each additional slice increases the output file size and computational overhead. For best performance, limit slices to key areas of interest.

- **Can I create slices at angles that aren't aligned with the coordinate axes?**  
  > Yes, by setting the appropriate normal vector. For example, a 45¬∞ plane between X and Y axes would use normal = (1, 1, 0).

- **What's the difference between paraview and tecplot formats?**  
  > Paraview format (.vtu) is for the open-source ParaView visualization tool, while Tecplot format (.plt) is for the commercial Tecplot software. Choose based on your preferred visualization tool.

</details>

---

<details>
<summary><h3 style="display:inline-block"> üêç Python Example Usage</h3></summary>

*The following example demonstrates how to configure slice outputs in your simulation using the Flow360 Python API.*

```python
import flow360 as fl
from flow360 import u

# Create a simulation setup
simulation = fl.SimulationParams(
    # Other simulation parameters...
)

# Define slice outputs
simulation.outputs.append(
    fl.SliceOutput(
        name="Wing Slices",
        entities=[
            fl.Slice(
                name="Wing Root",
                origin=(0, 0, 0) * u.m,
                normal=(0, 1, 0)
            ),
            fl.Slice(
                name="Midspan", 
                origin=(0, 5, 0) * u.m,
                normal=(0, 1, 0)
            ),
            fl.Slice(
                name="Wingtip",
                origin=(0, 10, 0) * u.m,
                normal=(0, 1, 0)
            )
        ],
        output_format="paraview",
        output_fields=["Mach", "pressure", "vorticity"],
        frequency=100,  # Save every 100 time steps
        frequency_offset=0  # Start saving from beginning of simulation
    )
)

# Create time-averaged slice output
simulation.outputs.append(
    fl.TimeAverageSliceOutput(
        name="Time Averaged Wake",
        entities=[
            fl.Slice(
                name="Wake Slice",
                origin=(2, 0, 0) * u.m,
                normal=(1, 0, 0)  # Normal to flow direction
            )
        ],
        output_fields=["velocity", "Cp", "turbulence"],
        start_step=1000,  # Start averaging from time step 1000
        frequency=500,    # Save every 500 time steps
        frequency_offset=1500  # Start saving from time step 1500
    )
)
```

</details>

---

> **Note**: For information on time-averaging slice output for unsteady simulations, see [Time-Averaged Slice Output](06.time-averaging-slice-output.md).
