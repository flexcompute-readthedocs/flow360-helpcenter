# Volume Output

*Volume Output in Flow360 allows you to visualize flow field variables throughout the entire computational domain. This is essential for understanding 3D flow structures, vortex development, shockwaves, and other volumetric flow features.*

---

## **Available Options**

| *Option* | *Description* | *Applicable* |
|----------|---------------|--------------|
| **Output fields** | Flow variables to include in the output |  always |
| **Output format** | Format for saving volume data | always |
| **Save interval** | When to save outputs | always |
| **Frequency** | How often to save outputs | when **Save interval** is `Custom` |
| **Frequency offset** | Time step at which to start the output animation | when **Save interval** is `Custom` |

---

## **Detailed Descriptions**

### **Output fields**

*Select the flow variables to include in the volume output.*

- **Default:** None selected
- **Example:** `Mach, pressure, qcriterion`
>**Notes:** 
>  - See detailed field descriptions below. 
>  - Only select fields you need to analyze to keep file sizes manageable.

### **Output format**

*The file format used to save the volume output data.*

- **Default:** `paraview`
- **Options:**
  - `paraview`
  - `tecplot`
  - `both`
> **Notes:** 
> - Choose the format that best suits your post-processing workflow.
> - Select `paraview` for `.vtu` format, `tecplot` for `.plt` format, or `both` to save in both formats.

### **Save interval**

*Choose the points in the simulation where the results are saved.*

- **Default:** `Save at end`
- **Options:**
  - `Save at end`
  - `Custom`
> **Notes:** 
> - Choose `Save at end` to save only the final results of the simulation.
> - Choose `Custom` to save the results in given intervals.

### **Frequency**

*How often to save outputs, in number of physical time steps.*

- **Default:** `-1` (only at the end of simulation)
- **Example:** `100`
>**Note:** Higher frequencies provide better temporal resolution but increase storage requirements.

### **Frequency offset**

*The time step at which to start the output animation.*

- **Default:** `0` (beginning of simulation)
- **Example:** `1000`
>**Notes:** 
> - Useful when you want to skip initial transient flow development.
> - For time-averaged volume output settings, see the [Time-Averaged Volume Output](02.time-averaging-volume-output.md) documentation.

---

## **Available Output Fields**

Variables from [Available Output Fields](README.md#available-output-fields) and the following specific variables

### **Volume-Specific Variables** (non-dimensional)

- `betMetrics` - BET Metrics
- `betMetricsPerDisk` - BET Metrics per Disk
- `linearResidualNavierStokes` - Linear residual of Navier-Stokes solver
- `linearResidualTurbulence` - Linear residual of turbulence solver
- `linearResidualTransition` - Linear residual of transition solver
- `SpalartAllmaras_hybridModel` - Hybrid RANS-LES output for Spalart-Allmaras solver (supports both DDES and ZDES)
- `kOmegaSST_hybridModel` - Hybrid RANS-LES output for kOmegaSST solver (supports both DDES and ZDES)
- `localCFL` - Local CFL number

### **Hybrid RANS-LES Output Variables**

The `SpalartAllmaras_hybridModel` and `kOmegaSST_hybridModel` output fields provide diagnostic variables for hybrid RANS-LES simulations. The specific variables included depend on whether you're using **DDES** (Delayed Detached Eddy Simulation) or **ZDES** (Zonal Detached Eddy Simulation) as the shielding function.

#### **DDES Variables** (when `shielding_function="DDES"`)

When using DDES, the hybrid model output includes five key variables:

1. **`f_d`** ‚Äì The shielding function that delineates the RANS and LES regions. When `f_d` = 0, the RANS model is fully applied; when `f_d` = 1, the LES model is used. Intermediate values represent a smooth transition between the two regimes.

2. **`r_d`** ‚Äì A modified ratio of the modeled length scale to the wall distance, from which `f_d` is derived.

3. **`DDES_lengthRANS`** ‚Äì The wall distance from the computational cell to the nearest solid boundary.

4. **`DDES_lengthScale`** ‚Äì The characteristic DES length scale: $$\tilde{d} \equiv d - f_d \max(0, d - C_{DES}*\Delta)$$

5. **`DDES_lengthLES`** ‚Äì The characteristic LES length scale: $$C_{DES}*\Delta$$

Among these variables, `f_d` is the most significant, as it enables users to identify and visualize the regions dominated by RANS and DES behavior within the computational domain.

#### **ZDES Variables** (when `shielding_function="ZDES"`)

When using ZDES, the hybrid model output includes four key variables:

1. **`ZDES_fd`** ‚Äì The primary shielding function for ZDES. Similar to DDES `f_d`, this function controls the transition between RANS and LES regions. When `ZDES_fd` = 0, RANS is active; when `ZDES_fd` = 1, LES is active.

2. **`ZDES_fR`** ‚Äì The RANS shielding function. This is one of the dual shielding functions used in ZDES mode 2 (EP) to robustly shield attached boundary layers, preventing premature transition from RANS to LES regardless of mesh refinement and adverse pressure gradients.

3. **`ZDES_fp`** ‚Äì The primary protection function. This function is part of the inhibition mechanism based on wall-normal gradients that helps maintain RANS behavior in attached boundary layers.

4. **`ZDES_fp2`** ‚Äì The secondary protection function. This additional protection function works in conjunction with `ZDES_fp` to provide enhanced shielding of attached boundary layers, ensuring a case-independent, automatic solution for accurately simulating both attached and massively separated turbulent flows.

> **Note**: The ZDES formulation employs dual shielding functions and an inhibition mechanism that makes it more tolerant to grid refinement (dx/Œ¥ ratio) compared to DDES, making it particularly suitable for cases with fine meshes or adverse pressure gradients.

---

<details>
<summary><h3 style="display:inline-block"> üí° Tips </h3></summary>

### Q-Criterion

The `qcriterion` field is extremely valuable for visualizing vortices in the flow field. To effectively use this field:

- Create isosurfaces of Q-criterion to identify vortical structures
- The default isosurface value is calculated as `RefMach¬≤ / (all walls' bounding box length)¬≤`
- For aircraft simulations: a good starting value is approximately `Mach¬≤ / WingSpan¬≤`
- For rotor flows: try `TipMach¬≤ / RotorDiameter¬≤`
- Smaller values show more vortical structures but may clutter visualization
- Larger values show only the strongest vortices

> **Note**: Q-criterion can also be directly exported as an isosurface with a specific iso value using the [Isosurface Output](./11.isosurface-output.md) feature, which provides better control over the visualization.

### BET Visualization

When using Blade Element Theory (BET) models for propellers or rotors, the `betMetrics` field provides valuable data for analyzing:

- Blade loading distributions
- Induced velocities
- Local angle of attack
- Flow conditions at each blade element

These metrics are essential for understanding propeller and rotor performance characteristics.

### ‚ùì Performance Considerations

Volume outputs can generate very large files, especially for fine meshes. Consider the following to manage file sizes:

1. Limit the frequency of volume outputs
2. Be selective about which fields to include
3. Use time-averaged volume outputs for statistical analysis of unsteady flows
4. Consider using slices or isosurfaces instead for targeted analysis

</details>

---

<details>
<summary><h3 style="display:inline-block"> ‚ùì Frequently Asked Questions</h3></summary>

- **How large are volume output files typically?**  
  > File sizes depend on mesh size, selected output fields, and output format. For a mesh with several million cells:
  > - Each field adds approximately 4-8 bytes per cell
  > - A full domain output with 5 fields might be 1-5GB per time step for 100M mesh
  > - Consider using time-averaged outputs or selective fields to reduce storage requirements

- **What's the difference between ParaView and Tecplot formats?**  
  > - **ParaView format** (.vtu): Open-source visualization tool with excellent performance for large datasets. Provides a wide range of visualization and analysis capabilities.
  > - **Tecplot format** (.szplt): Commercial visualization software with specialized aerodynamic analysis tools. May provide more streamlined workflows for certain aerospace applications.
  > - Choose "both" if you're unsure which tool you'll need or if different team members use different tools.

- **How do I choose the right frequency for volume outputs?**  
  > Consider these factors:
  > - For steady-state simulations: Set to `-1` (final solution only) or use a high number (e.g., every 1000 steps)
  > - For unsteady simulations: Ensure you capture the relevant time scales (e.g., for vortex shedding, ensure at least 20-30 snapshots per shedding cycle)
  > - Storage constraints: Higher frequencies generate more data
  > - A good starting point for unsteady flows is 50-100 time steps between outputs

- **Why are my volume outputs missing data in certain regions?**  
  > Missing data in volume outputs typically occurs for these reasons:
  > - For parallel simulations, check that all partitions are being correctly combined
  > - Ensure the simulation has valid data in those regions (check convergence)
  > - For moving mesh simulations, ensure mesh movement is properly configured

- **How can I visualize specific flow features effectively?**  
  > For different flow features:
  > - **Vortices**: Use Q-criterion (isosurfaces) with values around `Mach¬≤/Length¬≤`
  > - **Shock waves**: Density gradient or Mach number gradients work well
  > - **Boundary layers**: Use slices with velocity profiles near walls
  > - **Wake structures**: Combine Q-criterion with velocity magnitude contours

- **Can I add custom output fields to volume output?**  
  > Currently, Flow360 supports only the predefined output fields listed in this documentation. If you need additional derived quantities:
  > - Export the primitive variables and calculate derived quantities in your visualization tool
  > - Use Python post-processing with the Flow360 API to create custom fields
  > - Contact support if you need a specific field that might benefit other users

</details>

---

<details>
<summary><h3 style="display:inline-block"> üêç Python Example Usage</h3></summary>

```python
# Example of configuring volume output using Flow360 Python API
import flow360 as fl

# Define volume output settings
volume_output = fl.VolumeOutput(
    name="Main Flow Volume",
    output_format="paraview",
    output_fields=["Mach", "pressure", "qcriterion", "velocity"],
    frequency=100,  # Save every 100 time steps
    frequency_offset=1000,  # Start at time step 1000
)

# Add volume output to simulation parameters
simulation_params = fl.SimulationParams(
    # ... other simulation parameters ...
    outputs=[volume_output]
)
```

</details>
