# Force Output

*Force Output allows you to select specific force and moment coefficient fields from forces and moments calculations and optionally apply moving statistics functions to track these values over time.*

---

## **Available Options**

| *Option* | *Description* | *Applicable* |
|----------|---------------|--------------|
| **Output fields** | Force and moment coefficient fields to include in the output | always |
| **Statistics function** | Optional moving statistics function to apply to the output fields | always |
| **Moving window size** | Size of the moving window for statistics calculation | when **Statistics function** is not `None` |
| **Start step** | Step at which to start calculating statistics | when **Statistics function** is not `None` |
| **Assigned models** | Surface or volume models whose force contributions will be calculated | always |

---

## **Detailed Descriptions**

### **Output fields**

*The force and moment coefficient fields that will be included in the force output.*

- **Required:** Yes (at least one field must be selected)
- **Available fields:**
  - `CL` - Lift coefficient
  - `CD` - Drag coefficient
  - `CFx` - Force coefficient in x-direction
  - `CFy` - Force coefficient in y-direction
  - `CFz` - Force coefficient in z-direction
  - `CMx` - Rolling moment coefficient (moment about x-axis)
  - `CMy` - Pitching moment coefficient (moment about y-axis)
  - `CMz` - Yawing moment coefficient (moment about z-axis)
  - For surface forces, you can also select pressure and skin friction contributions separately:
    - `CLPressure`, `CDPressure`, etc. - Pressure component
    - `CLSkinFriction`, `CDSkinFriction`, etc. - Skin friction component

- **Example:** `["CL", "CD", "CMz"]`
>**Note:** Select the fields you need for your analysis. Force coefficients are calculated based on the reference dimensions specified in the simulation setup.

### **Statistics function**

*Optional moving statistics function to apply to the output fields. When set to `None`, raw force and moment values are output. When a statistics function is selected, the specified statistic is calculated over a moving window.*

- **Default:** `None`
- **Options:**
  - `None` - No statistics processing, output raw values
  - `mean` - Moving average
  - `min` - Minimum value in the window
  - `max` - Maximum value in the window
  - `standard_deviation` - Sample standard deviation
  - `range` - Difference between maximum and minimum values

>**Note:** When a statistics function is selected, you must specify the moving window size and start step.

### **Moving window size**

*The size of the moving window (in number of data points) over which the statistics function is calculated.*

- **Required:** Yes (when statistics function is not `None`)
- **Default:** None
- **Example:** `10`
>**Notes:**
>- The window size is defined by the number of data points recorded in the output.
>- For steady simulations, the solver typically outputs a data point once every **10 pseudo steps**. This means a window size of 10 would cover 100 pseudo steps.
>- For unsteady simulations, the solver outputs a data point for **every physical step**. A window size of 10 would cover 10 physical steps.
>- Must be greater than or equal to 2.

### **Start step**

*The step number at which to start calculating the statistics function.*

- **Required:** Yes (when statistics function is not `None`)
- **Default:** None
- **Example:** `100`
>**Notes:**
>- For steady simulations, the start step value is automatically rounded up to the nearest multiple of 10.
>- This allows you to skip initial transients or convergence phases before applying statistics.
>- Must be a non-negative integer.

### **Assigned models**

*The surface or volume models whose force contributions will be calculated and included in the force output.*

- **Required:** Yes (at least one model must be selected)
- **Available model types:**
  - Wall models (for surface forces)
  - BET Disk models
  - Actuator Disk models
  - Porous Media models
  - Other models that generate forces and moments

- **Example:** A wall model named "wing" or a BET disk model named "rotor"
>**Notes:**
>- Select models by clicking the "+" button and choosing from available models in your simulation setup.
>- You can assign multiple models to a single Force Output to aggregate their force contributions.
>- Each model can only be assigned once per Force Output (no duplicates).

---

## **Use Cases**

Force Output is useful for:

- Tracking aerodynamic performance metrics (lift, drag, moments) during simulation
- Monitoring convergence of force coefficients
- Analyzing force contributions from different components (e.g., wing, tail, rotor)
- Applying statistical analysis to unsteady force data
- Comparing force outputs with experimental data

---

<details>
<summary><h3 style="display:inline-block"> üí° Tips</h3></summary>

- Use Force Output to track key performance metrics throughout your simulation
- Apply moving statistics (e.g., mean, standard deviation) to analyze unsteady force data
- For steady simulations, remember that window sizes and start steps are automatically adjusted to multiples of 10
- Select only the force coefficient fields you need to keep output files manageable
- Combine multiple models in a single Force Output to track aggregate forces

</details>

---

<details>
<summary><h3 style="display:inline-block"> ‚ùì Frequently Asked Questions</h3></summary>

- **What's the difference between Force Output and Surface Integral Output?**  
  > Force Output provides force and moment coefficients (non-dimensional values) for specific models, while Surface Integral Output provides dimensional integrated force and moment values on surfaces.

- **Can I track pressure and skin friction contributions separately?**  
  > Yes, you can select fields like `CLPressure` and `CLSkinFriction` to separate the pressure and viscous contributions to force coefficients.

- **How do moving statistics work for steady vs unsteady simulations?**  
  > For steady simulations, data points are output every 10 pseudo steps, so a window size of 10 covers 100 pseudo steps. For unsteady simulations, data points are output every physical step, so the window size directly corresponds to the number of physical steps.

- **Can I assign the same model to multiple Force Outputs?**  
  > Yes, you can create multiple Force Output configurations with different fields or statistics settings and assign the same model to each.

- **What happens if I don't specify a statistics function?**  
  > If the statistics function is set to `None`, raw force and moment coefficient values are output at each data point without any statistical processing.

</details>

---

<details>
<summary><h3 style="display:inline-block"> üêç Python Example Usage</h3></summary>

#### Basic Force Output Example

```python
import flow360 as fl
from flow360 import u

# Create a wall model
wall = fl.Wall(
    name="wing",
    surfaces=[volume_mesh["wing1"], volume_mesh["wing2"]]
)

# Define a basic force output with CL and CD
force_output = fl.ForceOutput(
    name="wing_forces",
    models=[wall],
    output_fields=["CL", "CD"]
)
```

#### Force Output with Moving Statistics

```python
# Define force output with moving statistics
force_output_with_stats = fl.ForceOutput(
    name="wing_forces_statistics",
    models=[wall],
    output_fields=["CL", "CD", "CMz"],
    moving_statistic=fl.MovingStatistic(
        method="mean",
        moving_window_size=10,
        start_step=100
    )
)
```

#### Force Output with Multiple Models

```python
# Create multiple models
wall = fl.Wall(name="wing", surfaces=[volume_mesh["wing"]])
bet_disk = fl.BETDisk(...)

# Combine forces from multiple models
combined_force_output = fl.ForceOutput(
    name="combined_forces",
    models=[wall, bet_disk],
    output_fields=["CL", "CD", "CMz"]
)
```

#### Force Output with Pressure and Skin Friction Separation

```python
# Track pressure and skin friction separately
detailed_force_output = fl.ForceOutput(
    name="detailed_forces",
    models=[wall],
    output_fields=[
        "CL",
        "CLPressure",
        "CLSkinFriction",
        "CD",
        "CDPressure",
        "CDSkinFriction"
    ]
)
```

</details>
