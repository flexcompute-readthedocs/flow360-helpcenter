# Time-averaging Volume Output

*Time-averaging Volume Output in Flow360 allows you to calculate and visualize time-averaged flow variables throughout the entire computational domain. This is essential for statistical analysis of unsteady flows and understanding mean flow characteristics.*

## **Available Options**

| *Option* | *Description* | *Applicable* |
|----------|---------------|--------------|
| **Output fields** | Flow variables to include in the output |  always |
| **Output format** | Format for saving volume data | always |
| **Start step** | When to begin time-averaging | always |
| **Save interval** | When to save outputs | always |
| **Frequency** | How often to save outputs | when **Save interval** is `Custom` |
| **Frequency offset** | Time step at which to start the output animation | when **Save interval** is `Custom` |


## **Detailed Descriptions**

### **Output fields**

*Select the flow variables to include in the volume output.*

- **Default:** None
- **Example:** `Mach, pressure, velocity`
>**Notes:** 
>  - See detailed field descriptions in the [Volume Output](01.volume-output.md#available-output-fields) page.
>  - Only select fields you need to analyze to keep file sizes manageable.

### **Output format**

*The file format used to save the volume output data.*

- **Default:** `paraview`
- **Options:**
  - `paraview`
  - `tecplot`
  - `both`
> **Notes:** 
> - Choose the format that best suits your post-processing workflow.
> - Select `paraview` for `.vtu` format, `tecplot` for `.plt` format, or `both` to save in both formats.

### **Start step**

*Specifies the physical time step to start calculating time averaging.*

- **Default:** `-1` (automatic detection)
- **Example:** `50`
>**Note:** Set this to begin averaging after initial transients have died out. When set to `-1`, the solver will automatically determine when to start averaging based on flow convergence

### **Save interval**

*Choose the points in the simulaton where the results are saved.*

- **Default:** `Save at end`
- **Options:**
  - `Save at end`
  - `Custom`
> **Notes:** 
> - Choose `Save at end` to save only the final results of the simulation.
> - Choose `Custom` to save the results in given intervals.

### **Frequency**

*How often to save outputs, in number of physical time steps.*

- **Default:** `1`
- **Example:** `10`
>**Note:** Higher frequencies provide better temporal resolution but increase storage requirements.

### **Frequency offset**

*The time step at which to start the output animation.*

- **Default:** `0` (beginning of simulation)
- **Example:** `100`
>**Note:** Useful when you want to skip initial transient flow development.

---

<details>
<summary><h3 style="display:inline-block"> üí° Tips</h3></summary>

Time-averaged volume output is particularly useful in the following scenarios:

1. **Analyzing unsteady flows**: For flows with inherent unsteadiness (like vortex shedding, turbulent wakes, or separated flows), time-averaging provides mean flow statistics.

2. **Reducing storage requirements**: Instead of saving many instantaneous snapshots, you can capture the statistical behavior with a single time-averaged result.

3. **Flow stability assessment**: Time-averaged results help determine if a flow has reached a statistically steady state, even if instantaneous values are fluctuating.

4. **Turbulence analysis**: For turbulent flows, time-averaging allows you to distinguish between mean flow patterns and turbulent fluctuations.

> **Note**: Time-averaged outputs are only available when using unsteady time stepping methods.

### Performance Considerations

Time-averaged volume outputs offer several advantages over series of instantaneous outputs:

1. **Reduced storage requirements**: Instead of storing many time steps, you can capture statistical behavior in a single file.

2. **Better statistical representation**: Time-averaging naturally filters out numerical noise and transient features.

3. **Computational overhead**: Time-averaging requires additional memory during the simulation to accumulate statistics, but this is typically minimal compared to the overall simulation cost.

4. **Convergence monitoring**: Monitor the convergence of time-averaged quantities to determine when your statistics have become stable.

</details>

---

<details>
<summary><h3 style="display:inline-block"> ‚ùì Frequently Asked Questions</h3></summary>

- **When should I use time-averaged outputs instead of regular volume outputs?**  
  > Time-averaged outputs are ideal when:
  > - You're analyzing statistically steady turbulent flows
  > - You need to filter out transient features or numerical noise
  > - You want to reduce storage requirements while still capturing overall flow behavior
  > - You're interested in mean flow characteristics rather than instantaneous snapshots
  > - You need statistical quantities like mean or RMS values for performance analysis

- **How does the Start Step parameter affect my results?**  
  > The `Start Step` parameter controls when the solver begins accumulating statistics for time-averaging:
  > - Setting it too early may include unwanted transient effects in your averages
  > - Setting it too late may not give enough time for statistical convergence
  > - The automatic setting (`-1`) detects when force coefficients begin to oscillate around a mean value
  > - For better control, monitor your force history and set it manually once transients have subsided

- **Can I get fluctuation intensity or RMS values from time-averaged outputs?**  
  > Currently, Flow360 time-averaged outputs include mean values only, not RMS or fluctuation intensities. To obtain these:
  > - Export both instantaneous and time-averaged data
  > - Post-process using ParaView/Tecplot to calculate RMS values
  > - For turbulence quantities, consider using the k and omega fields which represent turbulent kinetic energy and specific dissipation rate

- **How long should I run my simulation to get good time-averaged results?**  
  > For statistically meaningful time-averaged results:
  > - Continue at least 5-10 characteristic time periods after starting the averaging
  > - For external aerodynamics, typically 5-10 flow-through times past your geometry
  > - For periodic flows (vortex shedding), at least 20-30 shedding cycles
  > - Monitor key quantities (like forces) to ensure their time averages have converged

- **Do time-averaged outputs increase memory usage?**  
  > Time-averaged outputs require additional memory during the simulation:
  > - For each field being averaged, an additional array must be stored in memory
  > - The memory overhead scales linearly with the number of time-averaged fields
  > - On most modern systems, this is negligible compared to the overall simulation memory requirements
  > - If memory is constrained, be selective about which fields to time-average

- **What's the difference between "Start Step" and "Frequency Offset"?**  
  > These parameters serve different purposes:
  > - `Start Step`: When to begin accumulating data for the time average (affects the averaging calculation)
  > - `Frequency Offset`: When to begin writing output files (affects only output timing, not the calculation)
  > - Typically set `Start Step` based on flow physics (after transients)
  > - Set `Frequency Offset` based on output management preferences

</details>

---

<details>
<summary><h3 style="display:inline-block"> üêç Python Example Usage</h3></summary>

```python
# Example of configuring time-averaged volume output
import flow360 as fl

# Define time-averaged volume output settings
time_avg_output = fl.TimeAverageVolumeOutput(
    name="Time Averaged Flow",
    output_format="paraview",
    output_fields=["Mach", "pressure", "velocity"],
    frequency=10,           # Save results every 10 time steps
    frequency_offset=100,   # Start saving at time step 100
    start_step=50           # Begin averaging at time step 50
)

# Add to simulation parameters
simulation_params = fl.SimulationParams(
    # ... other simulation parameters ...
    outputs=[time_avg_output]
)
```

</details>