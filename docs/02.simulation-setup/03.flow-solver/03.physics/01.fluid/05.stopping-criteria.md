(stopping_criteria)=

# Stopping criteria

*Stopping criteria allow you to automatically terminate a simulation when monitored fields reach specified tolerance thresholds. Stopping criteria provide additional convergence control based on user-defined metrics of interest (such as force coefficients, probe values, or surface probe data), working in conjunction with solver tolerances—both must be satisfied for the simulation to stop.*

---

## **How Stopping Criteria Work**

When you configure one or more stopping criteria:

1. **Field Computation**: The specified output field is computed from the selected output type. For Force Outputs, this includes force and moment coefficients (such as lift, drag, and pitching moment). For Probe Outputs, this includes flow variables at point locations (such as pressure, Mach number, or velocity). For Surface Probe Outputs, this includes flow variables projected onto surfaces (such as pressure coefficient or skin friction).

2. **Combined Criteria Evaluation**: Stopping criteria provide additional convergence control based on user-defined metrics. The simulation stops when **both**:
   * All user-defined stopping criteria are satisfied (for each criterion, the monitored field change becomes lower than the specified tolerance; if a tolerance window size is specified, the criterion evaluates the variation of the monitored field within that window; if no tolerance window size is specified, the criterion directly compares the latest value with the tolerance), **and**
   * The solver tolerances are met (Navier-Stokes solver, turbulence solver, and transition model solver residuals are within their specified tolerances).

   If user-defined stopping criteria are met but the solver tolerances are not satisfied, the simulation continues until the solver tolerances are met. Conversely, if the solver tolerances are met first, the simulation continues until all user-defined stopping criteria are satisfied.

3. **Simulation Stop**: The simulation stops when all configured criteria are satisfied simultaneously. However, the maximum number of steps (set in time stepping configuration) has the highest authority and will stop the simulation regardless of other conditions.

> **Important:** There is an AND relation between user-defined stopping criteria and solver tolerances—both must be satisfied for the simulation to stop. However, the maximum number of steps overrides all other stopping conditions and will terminate the simulation when reached.

---

## **Available Parameters**

| *Parameter* | *Description* |
|-------------|---------------|
| **Name** | A descriptive name for the stopping criterion |
| **Output type** | The category of output to monitor (Force, Probe, or Surface Probe) |
| **Output field** | The specific scalar field within the selected output to monitor for convergence |
| **Tolerance** | The threshold for the moving deviation of the monitored field |
| **Tolerance window size** | The number of iterations over which to calculate the moving deviation |

---

## **Detailed Descriptions**

### **Name**

*A descriptive identifier for this stopping criterion.*

- **Default:** `"Criterion 1"`, `"Criterion 2"`, etc. (automatically assigned)
- **Example:** `"Lift convergence"`, `"Drag tolerance"`

### **Output type**

*Specifies the category of output that contains the field to be monitored.*

- **Default:** None
- **Options:**
  - `Force`: Monitor force and moment coefficients from force outputs
  - `Probe`: Monitor flow variables from probe outputs
  - `Surface Probe`: Monitor flow variables from surface probe outputs
> **Note:** The chosen output type must be configured in the [Output section](../../../04.output/README.md) of your simulation setup before it can be used here.

### **Output field**

*The specific scalar field within the selected output to monitor for convergence. The available fields depend on the output type: Force outputs provide force and moment coefficients, Probe outputs provide flow variables at point locations, and Surface Probe outputs provide flow variables on surfaces.*

- **Default:** None
- **Example:** `CD` (drag coefficient), `CL` (lift coefficient), `Cp` (pressure coefficient), `Mach` (Mach number)
> **Notes:**
> - The selected field must be one of the `output_fields` defined in the selected output instance.

### **Tolerance**

*Convergence threshold for the monitored field. The stopping criterion is satisfied when the monitored field change becomes lower than this tolerance. If a **Tolerance window size** is specified, the criterion evaluates the variation of the monitored field within that window. If no tolerance window size is specified, the criterion directly compares the latest value with the tolerance. Note that this criterion must be satisfied along with solver tolerances (Navier-Stokes, turbulence, and transition model residuals) for the simulation to stop.*

- **Default:** `0.01`
- **Example:** `1e-5`, `0.001`
> **Notes:**
> - This value is non-dimensional if the monitored field is a string-defined default field (e.g., `'CL'`, `'CD'`, `'Cp'`).

### **Tolerance window size**

*The number of data points from the monitor output used to check whether the variation of the monitored field within this window is below the tolerance. For steady simulations, this refers to the number of iterations. For unsteady simulations, this refers to the number of time steps. If not set, the criterion will directly compare the latest value with the tolerance.*

- **Default:** `100`
- **Example:** `50`, `200`
> **Notes:**
> - The value must be an integer greater than or equal to 2.
> - A larger window provides a more stable measure of convergence but may react slower to changes in the monitored field.

---

<details>
<summary><h3 style="display:inline-block"> ❓ Frequently Asked Questions</h3></summary>

- **Do I need to configure outputs before using them in stopping criteria?**  
  > Yes, you must first configure the outputs (Force, Probe, or Surface Probe) in the [Output section](../../../04.output/README.md) with the appropriate output fields. Only outputs that are already defined can be selected in the stopping criteria configuration.

- **What happens if I configure multiple stopping criteria?**  
  > All user-defined stopping criteria must be satisfied simultaneously, and they must also be satisfied along with solver tolerances (Navier-Stokes, turbulence, and transition model residuals). There is an AND relation between user-defined stopping criteria and solver tolerances—both must be satisfied for the simulation to stop. However, the maximum number of steps (set in time stepping configuration) has the highest authority and will stop the simulation when reached, regardless of other conditions.

- **Can I use a field that's not in my output's output_fields list?**  
  > No, the selected field must be one of the `output_fields` defined in the selected output instance. Make sure to include the field you want to monitor when configuring the output.

</details>

---

## **Related**

- [Probe Outputs](../../../04.output/02.outputs-list/07.probe-outputs.md) - Setting up probe outputs
- [Surface Probe Outputs](../../../04.output/02.outputs-list/09.surface-probe-outputs.md) - Setting up surface probe outputs
