# Mesh parameters

*The Mesh parameters in Flow360 provide fundamental control over mesh generation, affecting both surface and volume mesh characteristics. These settings serve as global defaults that determine the quality and characteristics of the computational mesh.*

## Available Options

| *Option* | *Description* | *Applicable* |
|----------|---------------|--------------|
| [**Surface edge growth rate**](#surface-edge-growth-rate) | Controls the size progression of elements grown from edges | always |
| [**Surface max edge length**](#surface-max-edge-length) | Maximum allowable edge length for surface elements | always |
| [**Surface max aspect ratio**](#surface-max-aspect-ratio) | Maximum aspect ratio for surface cells | Geometry AI |
| [**Geometry accuracy**](#geometry-accuracy) | Smallest length scale to be resolved by surface meshing | Geometry AI |
| [**Curvature resolution angle**](#curvature-resolution-angle) | Maximum angle a single surface mesh element can span | always |
| [**Sealing size**](#sealing-size) | Threshold size below which geometry gaps are closed | Geometry AI |
| [**Resolve face boundaries**](#resolve-face-boundaries) | Whether to resolve boundaries between adjacent faces | Geometry AI |
| [**Boundary layer growth rate**](#boundary-layer-growth-rate) | Growth rate for prismatic boundary layer elements | always |
| [**Boundary layer first layer thickness**](#boundary-layer-first-layer-thickness) | First layer thickness for volumetric anisotropic layers | always |
| [**Refinement factor**](#refinement-factor) | Global scaling factor for mesh refinement | `Advanced` |
| [**Gap treatment strength**](#gap-treatment-strength) | Controls mesh behavior in narrow gaps | `Advanced` |
| [**Number of boundary layers**](#number-of-boundary-layers) | Fixed number of boundary layer elements | `Advanced`, beta mesher |
| [**Planar face tolerance**](#planar-face-tolerance) | Tolerance for detecting planar faces | `Advanced` |
| [**Surface max adaptation iterations**](#surface-max-adaptation-iterations) | Maximum iterations for surface mesh adaptation | `Advanced`, Geometry AI |
| [**Preserve thin geometry**](#preserve-thin-geometry) | Whether thin geometry features should be resolved | `Advanced`, Geometry AI |
| [**Sliding interface tolerance**](#sliding-interface-tolerance) | Tolerance for sliding interface detection | `Advanced` |


## Detailed Descriptions

### Surface mesh

#### Surface edge growth rate

*Controls the size progression of mesh elements grown from edges, affecting the transition between regions of different refinement (anisotropic to isotropic).*

- **Default:** `1.2`
- **Units:** Dimensionless
>**Notes:** 
>  - Values must be greater than or equal to `1.0`, typically `1.1`‚Äì`1.25`
>  - Cannot be overridden per edge
>  - Higher values lead to faster mesh size growth but may reduce quality

#### Surface max edge length

*Defines the maximum allowable length for any mesh edge on surfaces.*

- **Required**
- **Units:** Length
>**Notes:**
>  - Can be overridden using [Surface Refinement](./06.refinements/02.surface-refinement.md)
>  - Should be chosen based on geometry scale and required resolution
>  - Affects overall mesh density and computational cost

#### Surface max aspect ratio

*Maximum aspect ratio allowed for surface mesh cells.*

- **Default:** `10`
- **Units:** Dimensionless
>**Notes:**
>  - Only available when using Geometry AI
>  - Cannot be overridden per face
>  - Lower values enforce more isotropic surface cells

#### Geometry accuracy

*The smallest length scale that will be resolved accurately by the surface meshing process.*

- **Required** (when using Geometry AI)
- **Units:** Length
>**Notes:**
>  - Only available when using Geometry AI
>  - Can be overridden with [Geometry Refinement](./06.refinements/07.geometry-refinement.md)
>  - A smaller value results in a finer mesh and higher cell count

#### Curvature resolution angle

*Specifies the maximum angular deviation allowed in the surface mesh.*

- **Default:** `12 degrees`
- **Units:** Angle
>**Notes:**
>  - Controls both:
>    1. Angle between cell normal and underlying surface normal
>    2. Angle between line segment normal and underlying curve normal
>  - Can be overridden per face only when using Geometry AI
>  - Lower values capture curvature more accurately but increase mesh density

#### Sealing size

*Threshold size below which all geometry gaps are automatically closed.*

- **Default:** `0 m`
- **Units:** Length
>**Notes:**
>  - Only available when using Geometry AI
>  - Can be overridden with [Geometry Refinement](./06.refinements/07.geometry-refinement.md)
>  - Useful for closing small holes or gaps in imperfect CAD geometry

#### Resolve face boundaries

*Toggle to specify whether boundaries between adjacent faces should be resolved accurately using anisotropic mesh refinement.*

- **Default:** `Off`
>**Notes:**
>  - Only available when using Geometry AI
>  - Can be overridden per face with [Surface Refinement](./06.refinements/02.surface-refinement.md)
>  - Improves mesh quality at face intersections

---

### Volume mesh

#### Boundary layer growth rate

*Defines the growth rate of prismatic layers in the boundary layer region.*

- **Default:** `1.2`
- **Units:** Dimensionless
>**Notes:**
>  - Controls thickness progression of successive boundary layer elements
>  - Values must be greater than or equal to `1.0`, typically `1.1`‚Äì`1.25`
>  - Lower values create more gradual growth but increase total element count
>  - Critical for accurate boundary layer resolution

#### Boundary layer first layer thickness

*Specifies the height of the first prismatic layer adjacent to wall surfaces.*

- **Required**
- **Units:** Length
>**Notes:**
>  - Can be overridden using [Boundary Layer Refinement](./06.refinements/03.boundary-layer-refinement.md)
>  - Critical for achieving desired y+ values
>  - Should be calculated based on Reynolds number and desired y+ value

---

### Advanced

#### Refinement factor

*Global scaling factor that affects the overall mesh refinement level.*

- **Default:** `1`
- **Units:** Dimensionless
>**Notes:**
>  - Not supported with beta mesher
>  - Adjusts all spacings in refinement regions and first layer thickness to generate r-times finer mesh
>  - For example, if `refinement factor = 2`, all spacings will be divided by \( 2^{1/3} \), resulting in approximately 2√ó more nodes
>  - Useful for quick mesh resolution studies

#### Gap treatment strength

*Controls how the mesh transitions in narrow gaps between surfaces.*

- **Default:** `0` (beta mesher uses `1.0`)
- **Units:** Dimensionless (range: 0‚Äì1)
>**Notes:**
>  - `0` = no treatment, `1` = most conservative treatment
>  - Higher values dedicate more space to isotropic mesh in narrow gaps
>  - Critical for mesh quality in tight geometric spaces

#### Number of boundary layers

*Specifies a fixed number of volumetric anisotropic (boundary layer) elements.*

- **Default:** Automatic (mesher calculates required layers)
- **Units:** Count
>**Notes:**
>  - Only supported by the beta mesher
>  - Cannot be overridden per face
>  - When not specified, the volume mesher automatically calculates the required number of layers to grow boundary layer elements to isotropic size

#### Planar face tolerance

*Tolerance used for detecting planar faces in the input geometry that need to be remeshed, such as symmetry planes.*

- **Default:** `1e-6`
- **Units:** Dimensionless (relative to largest bounding box dimension)
>**Notes:**
>  - Cannot be overridden per face
>  - Used to identify and preserve flat surfaces during meshing

#### Surface max adaptation iterations

*Maximum number of adaptation iterations for the surface mesher.*

- **Default:** `50`
- **Units:** Count
>**Notes:**
>  - Only available when using Geometry AI
>  - Higher values may improve mesh quality but increase meshing time

#### Preserve thin geometry

*Toggle to specify whether thin geometry features should be resolved accurately during the surface meshing process.*

- **Default:** `Off`
>**Notes:**
>  - Only available when using Geometry AI
>  - Resolves features with thickness roughly equal to **Geometry accuracy**
>  - Can be overridden with [Geometry Refinement](./06.refinements/07.geometry-refinement.md)
>  - May improve mesh quality but increase meshing time

#### Sliding interface tolerance

*Tolerance used for detecting or creating curves lying on sliding interfaces.*

- **Default:** `0.01`
- **Units:** Dimensionless (relative to smallest sliding interface radius defined within a case)
>**Notes:**
>  - Cannot be overridden per sliding interface
>  - Used when setting up rotating zones with sliding mesh interfaces

---

<details>
<summary><h3 style="display:inline-block"> üí° Tips</h3></summary>

- Use **Surface edge growth rate** between `1.1`‚Äì`1.3` for most applications
- Set **Surface max edge length** based on the largest geometric features requiring resolution
- For Geometry AI workflows, start with a larger **Geometry accuracy** and decrease iteratively to find the optimal balance
- Calculate **Boundary layer first layer thickness** based on desired y+ value using Reynolds number and flow conditions
- Use **Gap treatment strength** of `1.0` for automotive geometries with tight clearances
- Enable **Preserve thin geometry** when your model has thin features (e.g., trailing edges, fins) that must be captured

</details>

---

<details>
<summary><h3 style="display:inline-block"> ‚ùì Frequently Asked Questions</h3></summary>

- **How do I determine the appropriate first layer thickness?**
  > Calculate based on desired y+ value using Reynolds number and flow conditions. For turbulent flow with wall functions, target y+ ‚âà 30‚Äì100. For resolving the viscous sublayer, target y+ < 1.

- **What is Geometry accuracy and when do I need it?**
  > Geometry accuracy defines the smallest feature size the surface mesher will resolve. It is required when using Geometry AI and should be set based on the smallest important geometric features in your model.

- **When should I use Preserve thin geometry?**
  > Enable this when your geometry contains thin features (like trailing edges or cooling fins) with thickness close to the Geometry accuracy value that must be captured accurately.

- **What surface edge growth rate should I use?**
  > Start with the default of `1.2`. Use lower values (`1.1`‚Äì`1.15`) for more gradual transitions in critical regions, and higher values (up to `1.3`) where rapid growth is acceptable.

- **How does gap treatment strength affect my mesh?**
  > Higher values create more isotropic cells in narrow gaps, improving mesh quality but potentially increasing cell count. For automotive simulations, a value of `1.0` is recommended.

</details>

---

<details>
<summary><h3 style="display:inline-block"> üêç Python Example Usage</h3></summary>

```python
import flow360 as fl

# Basic meshing defaults
meshing_defaults = fl.MeshingDefaults(
    surface_edge_growth_rate=1.2,
    surface_max_edge_length=0.1 * fl.u.m,
    curvature_resolution_angle=12 * fl.u.deg,
    boundary_layer_growth_rate=1.2,
    boundary_layer_first_layer_thickness=0.01 * fl.u.mm,
)

# With Geometry AI features
meshing_defaults_gai = fl.MeshingDefaults(
    geometry_accuracy=0.001 * fl.u.m,
    surface_edge_growth_rate=1.2,
    surface_max_edge_length=0.1 * fl.u.m,
    surface_max_aspect_ratio=10,
    curvature_resolution_angle=12 * fl.u.deg,
    boundary_layer_growth_rate=1.2,
    boundary_layer_first_layer_thickness=0.01 * fl.u.mm,
    preserve_thin_geometry=True,
    sealing_size=0.0001 * fl.u.m,
)
```

</details>
